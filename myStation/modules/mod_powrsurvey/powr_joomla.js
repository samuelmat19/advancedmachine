!function(){function e(){if("http://localhost:3000"!=u&&"https://localhost:3000"!=u&&"http://10.0.2.2:3000"!=u&&"http://localhost:8888"!=u&&"samoanhighlandretreat.com"!=location.host)return!1;for(var e=0;e<arguments.length;e++)console.log(arguments[e])}function t(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)}function r(t,r,o,a,n,i){var d=t;e("Match:",t);var l=d.match(/powr-[^\s\]]*/i),s=d.match(/id="[^"]*"/i);null==s&&(s=d.match(/id='[^']*'/i)),null==s&&(s=d.match(/id=[^\]]*/i),null!=s&&(s=s[0].replace("id=",'id="')+'"')),null==s&&(s=d.match(/label="[^"]*"/i)),null==s&&(s=d.match(/label='[^']*'/i)),null==s&&(s="");var c='<div class="'+l+'" '+s+"></div>";return e("Result is:"+c),c}function o(e){var t={},r=e.search("\\?");e=e.substr(r+1);for(var o=e.split("&"),a=0;a<o.length;a++){var n=o[a].split("=");if("undefined"==typeof t[n[0]])t[n[0]]=n[1];else if("string"==typeof t[n[0]]){var i=[t[n[0]],n[1]];t[n[0]]=i}else t[n[0]].push(n[1])}return t}function a(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("msie")?parseInt(e.split("msie")[1]):!1}function n(e){for(var t=!1,r=e;r&&r!==document;r=r.parentNode)if(void 0!=r.classList&&r.classList.contains("powr-ignore")){t=!0;break}return t}function i(){try{return window.top.location.href}catch(t){return e("Couldn't get page url:",t),""}}function d(t,r,o){function a(){var a={message:"loaded",data:{iframe_index:r,parent_window_width:window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth,parent_window_height:window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight}};e("POWr.js sending load message to url"+o+"; iframe:",t),t.contentWindow.postMessage(JSON.stringify(a),o)}t.addEventListener?t.addEventListener("load",a):t.attachEvent("onload",a)}function l(t,r){var o=new XMLHttpRequest;o.open("GET",r,!0),o.withCredentials=!0,o.onreadystatechange=function(){if(e("Async ready state change!",o),o.readyState==XMLHttpRequest.DONE||4==o.readyState)if(200==o.status){e("POWr App Data:",o.responseText);var r=JSON.parse(o.responseText);r.iframe_index=t,POWR_RECEIVERS[t].data=r;var a=setInterval(function(){POWR_RECEIVERS[t].loaded&&(POWR_RECEIVERS[t].receiver.postMessage(JSON.stringify({message:"loadView",data:r}),POWR_RECEIVERS[t].url),clearInterval(a))},10)}else e("Error receiving POWr App Data")},o.send()}function s(t){e("Settings got a message!",t);try{var r=JSON.parse(t.data);if("viewLoaded"==r.message){e("Settings received view loaded");var o=r.data.iframe_index;POWR_RECEIVERS[o].loaded=!0}else if("updateSize"==r.message)if("undefined"!=typeof gadgets&&"undefined"!=typeof gadgets.window&&"undefined"!=typeof gadgets.window.adjustHeight)gadgets.window.adjustHeight(r.data.height);else{var o=r.data.iframe_index,a=document.querySelectorAll('[powrindex="'+o+'"]')[0];if(a.height=r.data.height+"px",a.style.height=r.data.height+"px",void 0!=r.data.postCss)for(var n in r.data.postCss)a.style[n]=r.data.postCss[n];e("Updating size of el",a)}else if("loadMe"==r.message){e("Settings received loadMe request");var o=r.data.iframe_index;void 0!=POWR_RECEIVERS[o]&&void 0!=POWR_RECEIVERS[o].data&&POWR_RECEIVERS[o].receiver.postMessage(JSON.stringify({message:"loadView",data:POWR_RECEIVERS[o].data}),POWR_RECEIVERS[o].url)}}catch(i){e("Error with message",i)}}function c(e){if(80==e.keyCode&&(m=!0,setTimeout(function(){m=!1},2e3)),38==e.keyCode&&m){for(var t=0;t<POWR_RECEIVERS.length;t++)POWR_RECEIVERS[t].receiver.postMessage(JSON.stringify({message:"showEdit"}),POWR_RECEIVERS[t].url);return e.preventDefault(),!1}if(40==e.keyCode&&m){for(var t=0;t<POWR_RECEIVERS.length;t++)POWR_RECEIVERS[t].receiver.postMessage(JSON.stringify({message:"hideEdit"}),POWR_RECEIVERS[t].url);return e.preventDefault(),!1}}var u="https://www.powr.io",p="https://www.powr.io";if("undefined"!=typeof loadPowr)return void e("Powr already loaded");window.addEventListener?window.addEventListener("message",s):window.attachEvent("onmessage",s);var g=0;POWR_RECEIVERS=[],loadPowr=function(){for(var s=null,c=null,v=null,m=!1,f=document.querySelectorAll("script"),h=0;h<f.length;h++){var E=f[h],w=E.getAttribute("src");if(void 0!=w){var R=E.getAttribute("powr-token"),y=E.getAttribute("external-type"),_=E.getAttribute("template-powr-token"),S=E.getAttribute("powr-load");if(void 0==S&&(S="async"),a()&&a()<=9&&(S="sync"),m=E.getAttribute("demo-mode"),void 0!=R?s=R:w.search("powr-token")>-1&&(v=o(w),void 0!==v["powr-token"]&&v["powr-token"].length>0&&(s=v["powr-token"])),void 0!=y?c=y:w.search("external-type")>-1&&(v=o(w),void 0!=v["external-type"]&&v["external-type"].length>0&&(c=v["external-type"])),void 0!=s||void 0!=c)break}}if(null==s||0==s.length)try{s=window.top.location.host}catch(C){s=""}var b=!0;if(b){for(var O=/\[powr-[^\]]*\]/gi,P=/\[powr-[^\s\]]*/gi,I=document.querySelectorAll("a"),h=0;h<I.length;h++){var W=I[h];if(!n(W)){var V=W.previousSibling,A=W.nextSibling;if(V&&A&&W.getAttribute("href")&&W.getAttribute("href").search("tel")>-1&&3==V.nodeType&&3==A.nodeType&&V.nodeValue.match(P)&&A.nodeValue.search("]")>-1){var L=W.innerHTML,N=V.nodeValue.match(/powr-[^\s\]]*/gi)[0],x=document.createElement("div");x.innerHTML='<div class="'+N+'" label="'+L+'"></div>',V.parentNode.removeChild(V),A.parentNode.removeChild(A),W.parentNode.replaceChild(x,W)}}}for(var I=document.querySelectorAll("body, body *"),h=0;h<I.length;h++){var W=I[h],k=W.childNodes;if(!n(W))for(var T=0;T<k.length;T++){var M=k[T];if(3==M.nodeType){var q=M.nodeValue,H=q.replace(O,r);if(H!=q){var x=document.createElement("div");x.innerHTML=H,W.replaceChild(x,M)}}}}}if(0==document.querySelectorAll("#powrIframeLoader").length){var J=document.createElement("div"),B=document.getElementsByTagName("base")[0]||document.getElementsByTagName("script")[0];J.id="powrIframeLoader",J.innerHTML="&shy;<style> .powrLoaded iframe { visibility: hidden; } </style>",B.parentNode.insertBefore(J,B)}for(var D=document.querySelectorAll("[class*=powr-]"),U=!1,h=0;h<D.length;h++){var j=D[h];if(!(n(j)||j.className.search("powrLoaded")>-1)){j.className+=" powrLoaded";for(var z=j.className.split(/\s+/),h=0;h<z.length;h++)if(0===z[h].toLowerCase().search("powr-")){var X=z[h].toLowerCase().replace("powr-","");break}if("undefined"==typeof X)return;"popup"==X&&(U=!0);var G=j.getAttribute("label");void 0==G&&(G=""),void 0==_&&(_="");var Y=j.getAttribute("id");void 0==Y&&(Y="");var F=j.getAttribute("view-mode");e("Unique label is "+Y);var K="true"==m||"true"==j.getAttribute("demo-mode")?!0:!1,Q=u+"/plugins/"+X+"/cached_view?load="+S+"&index="+g+"&unique_label="+Y+"&powr_token="+s+"&user_label="+encodeURIComponent(G)+"&demo_mode="+K,Z=p+"/plugins/"+X+"/view.json?unique_label="+Y+"&powr_token="+s+"&user_label="+encodeURIComponent(G)+"&demo_mode="+K;void 0!=c&&(Z+="&external_type="+c,Q+="&external_type="+c),void 0!=_&&(Z+="&template_powr_token="+_,Q+="&template_powr_token="+_),void 0!=F&&(Z+="&view_mode="+F,Q+="&view_mode="+F),e("page url IS "+i()),i()&&(Z+="&url="+encodeURIComponent(i())),Z+="&request_url="+encodeURIComponent(document.location.protocol+"//"+document.location.host);var $=document.createElement("iframe");$.src=Q,$.setAttribute("powrindex",g),$.width="100%",$.height="100%",$.frameBorder="0",$.style.visibility="visible",$.setAttribute("webkitallowfullscreen",""),$.setAttribute("mozallowfullscreen",""),$.setAttribute("allowfullscreen","");try{/iPhone|iPod|iPad/.test(navigator.userAgent)&&($.style.minWidth="100%",$.style.width="1px",$.setAttribute("scrolling","no"))}catch(ee){console.log("Err: "+ee)}d($,g,Q),j.appendChild($);var te=$.contentWindow;POWR_RECEIVERS.push({receiver:te,url:Q}),"async"==S&&l(g,Z),g++}}U&&(t(document,"click",function(e){var e=e?e:window.event,t=e.relatedTarget||e.toElement;if(t&&t.classList.contains("trigger-popup"))for(var r=0;r<POWR_RECEIVERS.length;r++)POWR_RECEIVERS[r].receiver.postMessage(JSON.stringify({message:"triggerPowrPopupClick"}),POWR_RECEIVERS[r].url)}),t(document,"mouseout",function(e){var e=e?e:window.event,t=e.relatedTarget||e.toElement;if(e.clientY<5&&(!t||"HTML"==t.nodeName))for(var r=0;r<POWR_RECEIVERS.length;r++)POWR_RECEIVERS[r].receiver.postMessage(JSON.stringify({message:"exitDocument"}),POWR_RECEIVERS[r].url)}))};for(var v=0;10>v;v++)setTimeout(function(){loadPowr()},2e3*v);t(window,"load",loadPowr);var m=!1;t(window,"keydown",c)}();